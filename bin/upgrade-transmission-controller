#!/bin/bash
#
# Installs/upgrades transmission-controller
#

set -eu

src_url=git@github.com:KonishchevDmitry/transmission-controller.git
src_path=~/programs/transmission-controller
install_path=/opt/bin/transmission-controller

if [ -e "$src_path" ]; then
    cd "$src_path" && git pull
else
    git clone "$src_url" "$src_path" && cd "$src_path"
fi

set -x

cargo build --release
sudo install "$src_path/target/release/transmission-controller" "$install_path"

for user in dmitry; do
    sudo systemctl restart transmission-controller@$user; sleep 1
    systemctl status transmission-controller@$user
done
